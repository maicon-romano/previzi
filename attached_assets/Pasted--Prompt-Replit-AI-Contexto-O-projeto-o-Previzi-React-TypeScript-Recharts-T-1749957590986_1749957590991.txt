### Prompt â†’ Replit AI

> **Contexto**
> O projeto Ã© o Previzi (React + TypeScript + Recharts + Tailwind). A pÃ¡gina de previsibilidade estÃ¡ em `client/src/pages/Predictability.tsx`.
> Ela jÃ¡ exibe:
>
> * seletor de perÃ­odos (3 â€“ 120 meses)
> * KPIs (saldo atual, receita/ despesa projetadas, etc.)
> * grÃ¡ficos de linha (receitas por fonte, despesas por categoria, saldo acumulado)
> * tabela detalhada
> * cenÃ¡rios de investimento (10 % / 20 % / 30 % / 50 %)
>
> **Objetivo**
> Transformar a pÃ¡gina em uma ferramenta de decisÃ£o adicionando simulaÃ§Ã£o â€œE seâ€¦?â€, novos indicadores e ajustes visuais.

---

#### 1 â€“ Simulador â€œE seâ€¦?â€

1. **Criar estado global local** `simulatedItems: SimulatedItem[]`

   ```ts
   type SimulatedItem = {
     id: string;               // uuid
     type: 'income' | 'expense';
     description: string;
     amount: number;           // positivo sempre
     start: Date;
     end: Date | null;         // null = infinito
   };
   ```
2. **Modal/Drawer `ScenarioSimulator`**

   * Campos: Type (select), Description (text), Amount (currency), Start (date), End (date/âˆ).
   * ValidaÃ§Ã£o: amount > 0; start â‰¤ end (se definido).
   * â€œAdicionarâ€ â†’ push no `simulatedItems`.
3. Na tela, pequeno **badge contador** com â€œğŸ”® CenÃ¡rios (N)â€. Clicou â†’ abre modal.
4. Listar cenÃ¡rios ativos com toggle on/off e botÃ£o remover.

#### 2 â€“ Re-cÃ¡lculo em tempo-real

1. Extraia a funÃ§Ã£o `buildProjection(periodMonths, baseTransactions)` para util separado.
2. Ao calcular projeÃ§Ã£o:

   ```ts
   const effectiveTxs = [...firestoreTransactions, ...mappedSimulatedItems];
   ```

   Onde `mappedSimulatedItems` gera, na memÃ³ria, instÃ¢ncias mensais (similar Ã  lÃ³gica das recorrentes fixas).
3. KPIs, grÃ¡ficos e tabela devem reagir ao toggle dos cenÃ¡rios (use memo).
4. Quando qualquer cenÃ¡rio estÃ¡ ligado, mostre badge **â€œSimuladoâ€** em todos os cards KPI.

#### 3 â€“ Indicadores de saÃºde financeira

Adicionar 3 cards abaixo dos KPIs principais:

```ts
Taxa de PoupanÃ§a  = (Receita â€“ Despesa) / Receita mÃ©dia do perÃ­odo
Comprometimento   = Despesa de dÃ­vidas fixas / Receita mÃ©dia
Meses de FÃ´lego   = Saldo acumulado final / Despesa mÃ©dia
```

* Card recebe cor: verde/ amarelo/ vermelho conforme limites:

  * Taxa < 20 % amarelo, < 0 vermelho.
  * Comprometimento > 30 % amarelo, > 40 % vermelho.
  * FÃ´lego < 3 vermelho, 3â€“6 amarelo, > 6 verde.

#### 4 â€“ GrÃ¡ficos

* **Saldo acumulado**

  * Cor azul, Ã¡rea abaixo de zero em `fill="rgba(239,68,68,.2)"`.
  * Adicionar `ReferenceLine y={0}` vermelho.
* **Receitas / Despesas**

  * Manter mÃºltiplas linhas, mas aumentar strokeWidth = 3 e adicionar `Dot` maior.
* **Highlight negativo**: usar `Customized` ou `ReferenceDot` para marcar primeiro mÃªs com acumulado < 0 (âš ï¸).

#### 5 â€“ Heatmap (extra)

* Novo componente `BalanceHeatmap` sob a tabela.
* Usa `recharts/ScatterChart` ou grid CSS com classes Tailwind.
* Cada cÃ©lula colorida: verde â†’ saldo > 0, vermelho â†’ saldo < 0. Tooltip mostra mÃªs/saldo.

#### 6 â€“ Painel de recomendaÃ§Ãµes

* ApÃ³s calcular indicadores, gere array `recommendations` com Ã­cone+texto:

  * Saldo negativo futuro â†’ â€œReduza despesas em X ou aumente receita em Yâ€.
  * Taxa de poupanÃ§a baixa, etc.
* Renderizar em `<Alert variant="warning" />` ou `Card`.

#### 7 â€“ Refino visual

* Trocar label â€œ120 meses (10 anos)â€ por â€œ10 anosâ€.
* Colocar painel de investimento (10 â€“ 50 %) dentro de `<Accordion>` fechado por padrÃ£o.
* Adicionar botÃ£o **Exportar PDF** (pode ficar TODO).

---

#### AceitaÃ§Ã£o

* Togglar um cenÃ¡rio deve atualizar todos os KPIs, grÃ¡ficos e tabela sem refresh.
* Badge â€œSimuladoâ€ visÃ­vel quando â‰¥1 cenÃ¡rio ON.
* Primeiro mÃªs com saldo acumulado < 0 aparece com âš ï¸ no grÃ¡fico e na tabela.
* Indicadores mudam cor conforme regras.

> **Entrega**: pull request com alteraÃ§Ãµes em `Predictability.tsx`, novo `components/ScenarioSimulator.tsx`, `utils/projection.ts`, e qualquer asset extra (Ã­cones/companentes).
